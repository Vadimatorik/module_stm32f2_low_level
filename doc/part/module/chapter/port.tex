\chapter{Модуль работы с портами ввода-вывода общего назначения (PORT)}\label{port:0}
Данный модуль состоит из следующих классов:
\begin{itemize}
	\item \textbf{pin} (раздел~\ref{class:pin});
	\item \textbf{global\_port} (раздел~\ref{class:global:port});
\end{itemize}

\section{Класс pin}\label{class:pin}
\subsection{Общие сведения о классе}
Объект данного класса позволяет работать с конкретным выводом порта.

\subsection{Методы класса pin}
\begin{itemize}
	\item \textbf{constexpr pin ( const pin\_config\_t* const pin\_cfg\_array,  uint8\_t size = 1 );}\\Конструктор класса принимает указатель на структуру/массив структур конфигурации режима(-ов) работы  вывода.\\\textbf{Замечание 1: } в случае, если метод \textbf{reinit} объекта будет использован в коде пользователя или драйверах высокого уровня, структура/массив структур, на которую(-ый) ссылается указатель, полностью попадает во flash. В связи с тем, что метод \textbf{reinit} будет использовать структуру/элемент массива.
	\\\textbf{Замечание 2: }важно понимать, что все структуры конфигурации вывода (в случае, если передаётся указатель на массив структур) должны относится к одному физическому выводу (изменяя лишь режим его работы).
	\\\textbf{Замечание 3: }В случае, если в качестве параметра выступая единичная структура, а не массив структур, второй параметр указывать н нужно.
	\item \textbf{void	set		( void ) const;}\\Устанавливает 1 на выводе, если вывод сконфигурирован как выход;
	\item \textbf{void	reset	( void ) const;}\\Устанавливает 0 на выводе, если вывод сконфигурирован как выход;
	\item \textbf{void	set		( uint8\_t state ) const;}\\Устанавливает заданное состояние на выводе (1 или 0), если вывод сконфигурирован как выход;
	\item \textbf{void	set		( bool state ) const;}\\Устанавливает заданное состояние на выводе (true == 1 или false == 0), если вывод сконфигурирован как выход;
	\item \textbf{void	set		( int state ) const;}\\Устанавливает заданное состояние на выводе (1 или 0), если вывод сконфигурирован как выход;
	\item \textbf{void	invert	( void ) const;}\\Логическое \textbf{НЕ} состояния на выходе вывода, если вывод сконфигурирован как выход;
	\item \textbf{int		read	( void ) const;}\\Возвращает логическое состояние на входе вывода, если вывод сконфигурирован как вход;
	\item \textbf{EC\_ANSWER\_PIN\_REINIT	reinit	(uint8\_t number\_config) const;}\\Переинициализирует вывод в ходе выполнения программы в выбранную конфигурацию.\\\textbf{Замечание: }первичная инициализация вывода по нулевой (0) структуре производится объектом \textit{global\_port}. Что избавляет от надобности начальной инициализации вывода. Данный метод следует вызывать, если требуется изменить конфигурацию вывода на иную в ходе выполнения программы (при условии, что он не был заблокирован объектом \textit{global\_port}).\\\textbf{Возвращаемое значение:}
	\begin{itemize}
		\item \textbf{OK} - вывод был успешно переинициализирован;
		\item \textbf{LOCKED} - конфигурация вывода была заблокирована;
		\item \textbf{CFG\_NUMBER\_ERROR} - вы попытались инициализировать вывод несуществующей конфигурацией;
	\end{itemize}
\end{itemize}

\section{Класс global\_port}\label{class:global:port}
\subsection{Общие сведения о классе}
Объект данного класса позволяет работать со всеми имеющимися в контроллере портами ввода-вывода. В проекте должен быть один экземпляр (объект) данного класса. Объект предоставляет следующие возможности:
\begin{itemize}
	\item переинициализация конкретных или всех портов (при условии, что те не были заблокированы);
	\item блокировка конкретных или всех портов;
	\item получение данных о текущем состоянии блокировки;
\end{itemize}

\subsection{Методы класса global\_port}
\begin{itemize}
	\item \textbf{constexpr	global\_port	( const pin\_config\_t* const pin\_cfg\_array, const uint32\_t pin\_count );
	}\\Конструктор класса принимает указатель на структуру/массив структур конфигурации режима(-ов) работы  вывода(-ов). Сами структуры во flash загружены не будут (при условии, что они не были повторно использованы ещё и объектом класса \textit{pin}).\\На основе этих структур создаётся внутренняя структура \textit{gb\_msk\_struct}, содержащая в себе массив масок портов, физически разведённых в корпусе контроллера. Важно заметит следующее:
	\begin{itemize}
		\item размер массива зависит только от количества физически разведённых портов в корпусе контроллера и не зависит от количества переданных структур конфигурации выводов;
		\item на каждый физический вывод контроллера должна приходиться только одна структура конфигурации;
		\item в случае, если по ошибке будет передано несколько структур инициализации, ссылающиеся на один вывод, в итоговом массиве масок будет последняя конфигурация из массива структур;
		\item для тех выводов, для которых не было передано структуры инициализации, будет выбрана конфигурация по-умолчанию;
	\end{itemize}
	\item \textbf{E\_ANSWER\_GP	reinit\_all\_ports	( void ) const;}\\Метод инициализирует в реальном времени все порты ввода-вывода контроллера, основываясь на переданной(-ом) во время формирования объекта \textit{pin\_config} структуре/массиве структур (используется созданная конструктором структура с массивом масок портов).\\\textbf{Возвращаемое значение:}
	\begin{itemize}
		\item \textbf{SUCCESS} - переинициализация прошла успешно:	
		\item \textbf{LOOK} - порт заблокирован, переинициализация некоторых (или всех) выводов какого-то (или всех) порта(-ов) невозможна.\\\textbf{Заметка: } Может быть, что выводы одного или нескольких портов не были переинициализированы. В случае обнаружения блокировки порта производится попытка переинициализации (на случай, если требуется переинициализировать те выводы, которые заблокированы не были). Данное поведение можно изменить раскомментировав define \textit{NO\_REINIT\_PORT\_AFTER\_LOOKING} в файле stm32\_f20x\_f21x\_conf.h. В этом случае, если хоть порт был заблокирован ранее - попытки проинициализировать его не применяется и метод переходит к следующему порту.\\Если хоть один порт из имеющихся был ранее заблокирован, то будет возвращено именно \textbf{LOOK}, даже если другие были успешно проинициализированы.
	\end{itemize}
	\item \textbf{E\_ANSWER\_GP	reinit\_port	( EC\_PORT\_NAME port ) const;}\\Метод переинициализирует конкретный порт, основываясь на переданной(-ом) во время формирования объекта \textit{pin\_config} структуре/массиве структур (используются созданная конструктором структура с массивам масок портов).\\\textbf{Возвращаемое значение:}
	\begin{itemize}
		\item \textbf{SUCCESS} - переинициализация прошла успешно:	
		\item \textbf{LOOK} - порт заблокирован, переинициализация некоторых (или всех) выводов порта невозможна.
	\end{itemize}
	
	\item \textbf{E\_PORT\_LOCKED\_KEY	get\_state\_locked\_key\_port	( EC\_PORT\_NAME port ) const;}\\Метод возвращает состояние ключа блокировки порта.
	\item \textbf{E\_ANSWER\_PORT\_SET\_LOCK	set\_locked\_key\_port	( EC\_PORT\_NAME port ) const;}\\Метод блокирует конфигурацию выводов порта, подлежащих блокировке.
	\item \textbf{E\_ANSWER\_PORT\_SET\_LOCK	set\_locked\_keys\_all\_port	( void ) const; }\\Метод блокирует конфигурацию выводов, подлежащих блокировке, во всех портах.
\end{itemize}

\subsection{Замечания к классу global\_port}
\begin{itemize}
	\item В случае, если некоторые (или все) выводы порта/портов были заблокированы, попытка переинициализации выводов методами \textit{reinit\_all\_ports} и \textit{reinit\_port} все равно производится.\\Это нужно на случай, когда требуется переинициализировать некоторые (1 и более) выводов не трогая другие. Данное поведение можно сменить в stm32\_f20x\_f21x\_conf.h, раскомментировав define  \textbf{NO\_\-REINIT\_\-PORT\_\-AFTER\_\-LOOKING}.
\end{itemize}
